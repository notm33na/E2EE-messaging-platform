Threat Type,Threat Description,Evidence from Code,Mitigation,Coverage
S1 - Spoofing,JWT Token Forgery/Replay - Attacker steals valid JWT access token and reuses it to authenticate as user,"JWT tokens stored in client memory (`client/src/utils/tokenStore.js`), transmitted in Authorization headers. WebSocket accepts tokens from multiple sources (`server/src/websocket/socket-handler.js:29-31`). Tokens expire in 5 minutes (`server/src/utils/jwt.js:73`).","ES256 signature verification, short expiration (5m reduced from 15m), token rotation on refresh, minimized payload (email removed)",Full - Reduced expiration window significantly limits exposure window
S2 - Spoofing,Public Key Substitution Attack - Attacker replaces user's public identity key in MongoDB before key exchange,"Public keys stored in MongoDB (`server/src/models/PublicKey.js`), retrieved via `/api/keys/:userId` without additional verification. System relies on server trust for key distribution.","JWK validation, private key component removal, unique userId constraint, SHA-256 keyHash for integrity verification, rate limiting on key retrieval","Full - KeyHash provides integrity verification, rate limiting prevents enumeration"
S3 - Spoofing,"Ephemeral Key MITM Without Signature Verification - If signature verification bypassed, attacker intercepts KEP and replaces ephemeral keys","Signature verification is client-side only (`client/src/crypto/messages.js:146-152`). Server does not verify signatures (`server/src/controllers/kep.controller.js`), only relays.","ECDSA signature verification on ephemeral keys, identity public key verification",Full - Signature verification prevents MITM if identity keys are secure
S5 - Spoofing,"WebSocket Authentication Bypass - WebSocket allows unauthenticated connections, potentially accessing endpoints","WebSocket middleware allows connections without tokens (`server/src/websocket/socket-handler.js:33-36`), marking them as unauthenticated. Some handlers check authentication.","JWT verification in WebSocket middleware, requireAuth wrapper on all critical handlers (kep:init, kep:response, msg:send), connection limits per IP, message rate limiting","Full - All critical handlers require authentication, connection and rate limits prevent abuse"
T1 - Tampering,"Message Content Tampering in Transit - Attacker modifies ciphertext, IV, or authTag in transit",Messages encrypted with AES-256-GCM include auth tags (`client/src/crypto/aesGcm.js:55`). Tampering should be detected during decryption (`client/src/crypto/messageFlow.js:115-122`).,"AES-256-GCM authentication tags, auth tag verification during decryption",Full - Tampering detected via auth tag verification
T3 - Tampering,KEP Message Tampering (Signature Bypass) - Attacker modifies KEP message fields in transit,"Server acts as relay without signature verification (`server/src/controllers/kep.controller.js:10-108`). Client verifies signatures (`client/src/crypto/messages.js:146-152`), but if verification skipped or errors mishandled, tampered messages could be processed.","ECDSA signature verification, timestamp validation",Full - Signature verification prevents tampering
T6 - Tampering,File Chunk Reordering/Tampering - Attacker reorders or modifies encrypted file chunks,"File chunks encrypted independently (`client/src/crypto/fileEncryption.js:62-85`). Chunk order validated during decryption (`client/src/crypto/fileDecryption.js:36-43`), but if metadata tampered, validation may fail incorrectly.","Chunk index validation, AES-GCM auth tags per chunk",Full - Reordering and tampering detected
R1 - Repudiation,User Denies Sending Messages (No Message-Level Signatures) - User claims they did not send a message,"Messages encrypted with session keys derived from ephemeral keys. No identity key signatures on message content. Metadata in MongoDB provides some evidence, but without cryptographic signatures, non-repudiation is weak.","Message metadata storage with timestamps, audit logging, optional identity signatures on message envelopes, metadataHash for integrity",Full - Optional identity signatures provide cryptographic non-repudiation when enabled
I1 - Information Disclosure,Identity Private Key Theft from IndexedDB - Attacker extracts encrypted identity private keys,"Private keys encrypted with password-derived keys (`client/src/crypto/identityKeys.js:102-151`). Stored in IndexedDB (`identityKeys.js:129-145`). If IndexedDB compromised (XSS, browser extension, malware), encrypted keys can be extracted.","AES-256-GCM encryption with password-derived key, PBKDF2 key derivation, comprehensive password validation (8+ chars, uppercase, lowercase, number, special char) enforced at client and server, account lockout after 5 failed attempts (15 min lockout)",Full - Strong encryption + password validation + account lockout provides comprehensive protection against brute-force attacks
I2 - Information Disclosure,Session Key Extraction from IndexedDB - Attacker extracts session keys from IndexedDB,"Session keys stored in IndexedDB as base64 (`client/src/crypto/sessionManager.js:125-127`). Not encrypted beyond base64 encoding. If IndexedDB compromised, keys directly readable.","AES-256-GCM encryption of session keys (rootKey, sendKey, recvKey) with password-derived encryption key, PBKDF2 key derivation","Full - Session keys encrypted with AES-256-GCM, requires password to decrypt"
D2 - Denial of Service,WebSocket Connection Exhaustion - Attacker opens many WebSocket connections,No connection limits implemented (`server/src/websocket/socket-handler.js`). Each connection consumes memory and file descriptors. Sustained connections can exhaust server resources.,"Connection limits per IP (10 connections per IP), maxHttpBufferSize limit (10MB)",Full - Connection limits prevent resource exhaustion
E8 - Elevation of Privilege,Database Access Privilege Escalation - Attacker gains direct database access,"MongoDB connection uses credentials from environment (`database.js:7-20`). If credentials compromised or database directly accessible, attacker can modify any data, bypassing application-level authorization.","MongoDB connection authentication, environment variable protection, TLS/SSL enforced (tls: true), valid certificate required (tlsAllowInvalidCertificates: false), connection pooling limits (maxPoolSize: 10), connection timeouts, authSource specified","Full - TLS encryption, connection limits, and authentication requirements provide comprehensive database access protection"
